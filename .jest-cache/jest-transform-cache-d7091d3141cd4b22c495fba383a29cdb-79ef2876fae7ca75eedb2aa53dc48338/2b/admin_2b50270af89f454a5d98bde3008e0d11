6bb99e1940230bbfa53b1b9c7eacd7ee
import '../../../config/env.js';

// Set emulator configuration BEFORE any Firebase imports
const isTest = process.env.NODE_ENV === 'test' || process.env.NODE_ENV === 'e2e_test';
const isProduction = process.env.NODE_ENV === 'production';
if (isTest) {
  // Ensure Admin SDK uses emulators - set environment variables BEFORE any Firebase imports
  process.env.FIRESTORE_EMULATOR_HOST = process.env.FIRESTORE_EMULATOR_HOST || 'localhost:5004';
  process.env.FIREBASE_AUTH_EMULATOR_HOST = process.env.FIREBASE_AUTH_EMULATOR_HOST || 'localhost:9099';
  process.env.FIREBASE_STORAGE_EMULATOR_HOST = process.env.FIREBASE_STORAGE_EMULATOR_HOST || 'localhost:9199';

  // For test mode, ensure we have consistent project configuration
  process.env.FIREBASE_PROJECT_ID = process.env.FIREBASE_PROJECT_ID || 'demo-test';
  process.env.FIREBASE_STORAGE_BUCKET = process.env.FIREBASE_STORAGE_BUCKET || 'demo-test.appspot.com';
  console.log(`ðŸ§ª Admin SDK connecting to emulators - Auth: ${process.env.FIREBASE_AUTH_EMULATOR_HOST}, Firestore: ${process.env.FIRESTORE_EMULATOR_HOST}, Storage: ${process.env.FIREBASE_STORAGE_EMULATOR_HOST}`);
}
import { initializeApp, cert, getApp, getApps, deleteApp } from 'firebase-admin/app';
import { getAuth } from 'firebase-admin/auth';
import fs from 'fs';
import awsSecretsManager from '../../../config/awsSecretsManager.js';
const appName = "adminApp";

// Function to initialize or get the admin app
async function initializeAdmin() {
  console.log(`Initializing Admin SDK. NODE_ENV='${process.env.NODE_ENV}', isTest=${isTest}, isProduction=${isProduction}`);
  if (getApps().find(app => app.name === appName)) {
    console.log(`Admin app "${appName}" already exists. Returning existing instance.`);
    return getApp(appName);
  }
  let options;
  if (isTest) {
    console.log("Using Test configuration for Admin SDK with emulators.");
    options = {
      projectId: "demo-test",
      storageBucket: "demo-test.appspot.com"
    };
    console.log(`ðŸ§ª Admin SDK will use project: ${options.projectId}, storage: ${options.storageBucket}`);
  } else if (isProduction && process.env.USE_AWS_SECRETS === 'true') {
    console.log("Using Production configuration for Admin SDK with AWS Secrets Manager.");

    // In production with AWS Secrets Manager, try to get Firebase service account
    try {
      const firebaseServiceAccount = await awsSecretsManager.getFirebaseServiceAccount();
      if (!firebaseServiceAccount || !firebaseServiceAccount.project_id || !firebaseServiceAccount.private_key || !firebaseServiceAccount.client_email) {
        throw new Error('Firebase service account is missing required fields from AWS Secrets Manager');
      }
      options = {
        credential: cert(firebaseServiceAccount),
        projectId: firebaseServiceAccount.project_id,
        storageBucket: process.env.FIREBASE_STORAGE_BUCKET || firebaseServiceAccount.project_id + '.appspot.com'
      };
      console.log("Firebase Admin SDK initialized with service account from AWS Secrets Manager.");
    } catch (secretsManagerError) {
      console.warn(`Failed to get Firebase service account from AWS Secrets Manager: ${secretsManagerError.message}`);
      console.log("Attempting fallback to environment variables for Firebase configuration...");

      // Fallback to environment variables
      try {
        if (!process.env.FIREBASE_PROJECT_ID) {
          throw new Error('FIREBASE_PROJECT_ID environment variable is required when Firebase service account is not in AWS Secrets Manager');
        }

        // Use Application Default Credentials or environment-based initialization
        options = {
          projectId: process.env.FIREBASE_PROJECT_ID,
          storageBucket: process.env.FIREBASE_STORAGE_BUCKET || process.env.FIREBASE_PROJECT_ID + '.appspot.com'
        };

        // If we have a service account file path, use it
        if (process.env.GOOGLE_APPLICATION_CREDENTIALS && fs.existsSync(process.env.GOOGLE_APPLICATION_CREDENTIALS)) {
          console.log("Using GOOGLE_APPLICATION_CREDENTIALS file for Firebase authentication.");
          const serviceAccount = JSON.parse(fs.readFileSync(process.env.GOOGLE_APPLICATION_CREDENTIALS, 'utf8'));
          options.credential = cert(serviceAccount);
        } else {
          console.log("Using Application Default Credentials for Firebase authentication.");
          // Firebase Admin SDK will automatically use Application Default Credentials
          // This works in environments like Google Cloud Run, App Engine, etc.
        }
        console.log("Firebase Admin SDK initialized with environment variables fallback.");
      } catch (fallbackError) {
        console.error("Fallback to environment variables also failed:", fallbackError.message);
        throw new Error(`Failed to initialize Firebase Admin SDK with AWS Secrets Manager: ${secretsManagerError.message}. Fallback to environment variables also failed: ${fallbackError.message}. Please ensure either the Firebase service account is properly configured in AWS Secrets Manager, or FIREBASE_PROJECT_ID and GOOGLE_APPLICATION_CREDENTIALS are set.`);
      }
    }
  } else {
    console.log("Using Development configuration for Admin SDK with local service account file.");
    const serviceAccountPath = process.env.GOOGLE_APPLICATION_CREDENTIALS;
    if (!serviceAccountPath) {
      throw new Error("GOOGLE_APPLICATION_CREDENTIALS environment variable is not set.");
    }
    try {
      const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));
      options = {
        credential: cert(serviceAccount),
        projectId: serviceAccount.project_id,
        storageBucket: process.env.FIREBASE_STORAGE_BUCKET
      };
    } catch (e) {
      throw new Error(`Failed to load or parse Service Account Key: ${e.message}`);
    }
  }
  console.log(`Initializing admin app "${appName}" with project ID:`, options.projectId);
  const app = initializeApp(options, appName);

  // Log emulator connection status in test mode
  if (isTest) {
    console.log(`âœ… Admin app "${appName}" initialized for testing with emulators`);
  }
  return app;
}

// Lazy initialization cache
let adminAppPromise = null;

// Async function to get admin app
async function getAdminApp() {
  if (!adminAppPromise) {
    adminAppPromise = initializeAdmin();
  }
  return await adminAppPromise;
}

// For backward compatibility, export a synchronous version for non-production environments
let adminApp;
if (isTest || !isProduction || process.env.USE_AWS_SECRETS !== 'true') {
  // For test or development environments, initialize synchronously using the old approach
  console.log("Using synchronous initialization for development/test environment.");
  try {
    // Use the synchronous version for development
    if (isTest) {
      adminApp = initializeApp({
        projectId: "demo-test",
        storageBucket: "demo-test.appspot.com"
      }, appName);
      console.log(`ðŸ§ª Synchronous admin app initialized for testing with project: demo-test`);
    } else {
      const serviceAccountPath = process.env.GOOGLE_APPLICATION_CREDENTIALS;
      if (serviceAccountPath && fs.existsSync(serviceAccountPath)) {
        const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));
        adminApp = initializeApp({
          credential: cert(serviceAccount),
          projectId: serviceAccount.project_id,
          storageBucket: process.env.FIREBASE_STORAGE_BUCKET
        }, appName);
      } else {
        console.warn("GOOGLE_APPLICATION_CREDENTIALS not found. Will initialize when first accessed.");
      }
    }
  } catch (error) {
    console.warn('Warning: Synchronous admin app initialization failed:', error.message);
    console.log('Admin app will be initialized asynchronously when first accessed.');
  }
} else {
  console.log("Production mode detected. Admin app will be initialized asynchronously when first accessed.");
}
export { adminApp, getAdminApp };

// Optional: Function to clean up the admin app
export async function deleteAdminApp() {
  try {
    const appToDelete = getApp(appName);
    await deleteApp(appToDelete);
    console.log(`Admin app "${appName}" deleted.`);
    // Reset the promise cache
    adminAppPromise = null;
  } catch (error) {
    if (!error.message.includes("No Firebase App") && !error.message.includes("already deleted")) {
      console.warn(`Could not delete admin app "${appName}": ${error.message}`);
    }
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpc1Rlc3QiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJpc1Byb2R1Y3Rpb24iLCJGSVJFU1RPUkVfRU1VTEFUT1JfSE9TVCIsIkZJUkVCQVNFX0FVVEhfRU1VTEFUT1JfSE9TVCIsIkZJUkVCQVNFX1NUT1JBR0VfRU1VTEFUT1JfSE9TVCIsIkZJUkVCQVNFX1BST0pFQ1RfSUQiLCJGSVJFQkFTRV9TVE9SQUdFX0JVQ0tFVCIsImNvbnNvbGUiLCJsb2ciLCJpbml0aWFsaXplQXBwIiwiY2VydCIsImdldEFwcCIsImdldEFwcHMiLCJkZWxldGVBcHAiLCJnZXRBdXRoIiwiZnMiLCJhd3NTZWNyZXRzTWFuYWdlciIsImFwcE5hbWUiLCJpbml0aWFsaXplQWRtaW4iLCJmaW5kIiwiYXBwIiwibmFtZSIsIm9wdGlvbnMiLCJwcm9qZWN0SWQiLCJzdG9yYWdlQnVja2V0IiwiVVNFX0FXU19TRUNSRVRTIiwiZmlyZWJhc2VTZXJ2aWNlQWNjb3VudCIsImdldEZpcmViYXNlU2VydmljZUFjY291bnQiLCJwcm9qZWN0X2lkIiwicHJpdmF0ZV9rZXkiLCJjbGllbnRfZW1haWwiLCJFcnJvciIsImNyZWRlbnRpYWwiLCJzZWNyZXRzTWFuYWdlckVycm9yIiwid2FybiIsIm1lc3NhZ2UiLCJHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFMiLCJleGlzdHNTeW5jIiwic2VydmljZUFjY291bnQiLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJmYWxsYmFja0Vycm9yIiwiZXJyb3IiLCJzZXJ2aWNlQWNjb3VudFBhdGgiLCJlIiwiYWRtaW5BcHBQcm9taXNlIiwiZ2V0QWRtaW5BcHAiLCJhZG1pbkFwcCIsImRlbGV0ZUFkbWluQXBwIiwiYXBwVG9EZWxldGUiLCJpbmNsdWRlcyJdLCJzb3VyY2VzIjpbImFkbWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi4vLi4vLi4vY29uZmlnL2Vudi5qcyc7XG5cbi8vIFNldCBlbXVsYXRvciBjb25maWd1cmF0aW9uIEJFRk9SRSBhbnkgRmlyZWJhc2UgaW1wb3J0c1xuY29uc3QgaXNUZXN0ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyB8fCBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2UyZV90ZXN0JztcbmNvbnN0IGlzUHJvZHVjdGlvbiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbic7XG5cbmlmIChpc1Rlc3QpIHtcbiAgLy8gRW5zdXJlIEFkbWluIFNESyB1c2VzIGVtdWxhdG9ycyAtIHNldCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgQkVGT1JFIGFueSBGaXJlYmFzZSBpbXBvcnRzXG4gIHByb2Nlc3MuZW52LkZJUkVTVE9SRV9FTVVMQVRPUl9IT1NUID0gcHJvY2Vzcy5lbnYuRklSRVNUT1JFX0VNVUxBVE9SX0hPU1QgfHwgJ2xvY2FsaG9zdDo1MDA0JztcbiAgcHJvY2Vzcy5lbnYuRklSRUJBU0VfQVVUSF9FTVVMQVRPUl9IT1NUID0gcHJvY2Vzcy5lbnYuRklSRUJBU0VfQVVUSF9FTVVMQVRPUl9IT1NUIHx8ICdsb2NhbGhvc3Q6OTA5OSc7XG4gIHByb2Nlc3MuZW52LkZJUkVCQVNFX1NUT1JBR0VfRU1VTEFUT1JfSE9TVCA9IHByb2Nlc3MuZW52LkZJUkVCQVNFX1NUT1JBR0VfRU1VTEFUT1JfSE9TVCB8fCAnbG9jYWxob3N0OjkxOTknO1xuICBcbiAgLy8gRm9yIHRlc3QgbW9kZSwgZW5zdXJlIHdlIGhhdmUgY29uc2lzdGVudCBwcm9qZWN0IGNvbmZpZ3VyYXRpb25cbiAgcHJvY2Vzcy5lbnYuRklSRUJBU0VfUFJPSkVDVF9JRCA9IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQgfHwgJ2RlbW8tdGVzdCc7XG4gIHByb2Nlc3MuZW52LkZJUkVCQVNFX1NUT1JBR0VfQlVDS0VUID0gcHJvY2Vzcy5lbnYuRklSRUJBU0VfU1RPUkFHRV9CVUNLRVQgfHwgJ2RlbW8tdGVzdC5hcHBzcG90LmNvbSc7XG4gIFxuICBjb25zb2xlLmxvZyhg8J+nqiBBZG1pbiBTREsgY29ubmVjdGluZyB0byBlbXVsYXRvcnMgLSBBdXRoOiAke3Byb2Nlc3MuZW52LkZJUkVCQVNFX0FVVEhfRU1VTEFUT1JfSE9TVH0sIEZpcmVzdG9yZTogJHtwcm9jZXNzLmVudi5GSVJFU1RPUkVfRU1VTEFUT1JfSE9TVH0sIFN0b3JhZ2U6ICR7cHJvY2Vzcy5lbnYuRklSRUJBU0VfU1RPUkFHRV9FTVVMQVRPUl9IT1NUfWApO1xufVxuXG5pbXBvcnQgeyBpbml0aWFsaXplQXBwLCBjZXJ0LCBnZXRBcHAsIGdldEFwcHMsIGRlbGV0ZUFwcCB9IGZyb20gJ2ZpcmViYXNlLWFkbWluL2FwcCc7XG5pbXBvcnQgeyBnZXRBdXRoIH0gZnJvbSAnZmlyZWJhc2UtYWRtaW4vYXV0aCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IGF3c1NlY3JldHNNYW5hZ2VyIGZyb20gJy4uLy4uLy4uL2NvbmZpZy9hd3NTZWNyZXRzTWFuYWdlci5qcyc7XG5cbmNvbnN0IGFwcE5hbWUgPSBcImFkbWluQXBwXCI7XG5cbi8vIEZ1bmN0aW9uIHRvIGluaXRpYWxpemUgb3IgZ2V0IHRoZSBhZG1pbiBhcHBcbmFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVBZG1pbigpIHtcbiAgY29uc29sZS5sb2coYEluaXRpYWxpemluZyBBZG1pbiBTREsuIE5PREVfRU5WPScke3Byb2Nlc3MuZW52Lk5PREVfRU5WfScsIGlzVGVzdD0ke2lzVGVzdH0sIGlzUHJvZHVjdGlvbj0ke2lzUHJvZHVjdGlvbn1gKTtcblxuICBpZiAoZ2V0QXBwcygpLmZpbmQoYXBwID0+IGFwcC5uYW1lID09PSBhcHBOYW1lKSkge1xuICAgIGNvbnNvbGUubG9nKGBBZG1pbiBhcHAgXCIke2FwcE5hbWV9XCIgYWxyZWFkeSBleGlzdHMuIFJldHVybmluZyBleGlzdGluZyBpbnN0YW5jZS5gKTtcbiAgICByZXR1cm4gZ2V0QXBwKGFwcE5hbWUpO1xuICB9XG5cbiAgbGV0IG9wdGlvbnM7XG5cbiAgaWYgKGlzVGVzdCkge1xuICAgIGNvbnNvbGUubG9nKFwiVXNpbmcgVGVzdCBjb25maWd1cmF0aW9uIGZvciBBZG1pbiBTREsgd2l0aCBlbXVsYXRvcnMuXCIpO1xuICAgIG9wdGlvbnMgPSB7XG4gICAgICBwcm9qZWN0SWQ6IFwiZGVtby10ZXN0XCIsXG4gICAgICBzdG9yYWdlQnVja2V0OiBcImRlbW8tdGVzdC5hcHBzcG90LmNvbVwiXG4gICAgfTtcbiAgICBjb25zb2xlLmxvZyhg8J+nqiBBZG1pbiBTREsgd2lsbCB1c2UgcHJvamVjdDogJHtvcHRpb25zLnByb2plY3RJZH0sIHN0b3JhZ2U6ICR7b3B0aW9ucy5zdG9yYWdlQnVja2V0fWApO1xuICB9IGVsc2UgaWYgKGlzUHJvZHVjdGlvbiAmJiBwcm9jZXNzLmVudi5VU0VfQVdTX1NFQ1JFVFMgPT09ICd0cnVlJykge1xuICAgIGNvbnNvbGUubG9nKFwiVXNpbmcgUHJvZHVjdGlvbiBjb25maWd1cmF0aW9uIGZvciBBZG1pbiBTREsgd2l0aCBBV1MgU2VjcmV0cyBNYW5hZ2VyLlwiKTtcbiAgICBcbiAgICAvLyBJbiBwcm9kdWN0aW9uIHdpdGggQVdTIFNlY3JldHMgTWFuYWdlciwgdHJ5IHRvIGdldCBGaXJlYmFzZSBzZXJ2aWNlIGFjY291bnRcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlyZWJhc2VTZXJ2aWNlQWNjb3VudCA9IGF3YWl0IGF3c1NlY3JldHNNYW5hZ2VyLmdldEZpcmViYXNlU2VydmljZUFjY291bnQoKTtcbiAgICAgIFxuICAgICAgaWYgKCFmaXJlYmFzZVNlcnZpY2VBY2NvdW50IHx8ICFmaXJlYmFzZVNlcnZpY2VBY2NvdW50LnByb2plY3RfaWQgfHwgIWZpcmViYXNlU2VydmljZUFjY291bnQucHJpdmF0ZV9rZXkgfHwgIWZpcmViYXNlU2VydmljZUFjY291bnQuY2xpZW50X2VtYWlsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmlyZWJhc2Ugc2VydmljZSBhY2NvdW50IGlzIG1pc3NpbmcgcmVxdWlyZWQgZmllbGRzIGZyb20gQVdTIFNlY3JldHMgTWFuYWdlcicpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBvcHRpb25zID0ge1xuICAgICAgICBjcmVkZW50aWFsOiBjZXJ0KGZpcmViYXNlU2VydmljZUFjY291bnQpLFxuICAgICAgICBwcm9qZWN0SWQ6IGZpcmViYXNlU2VydmljZUFjY291bnQucHJvamVjdF9pZCxcbiAgICAgICAgc3RvcmFnZUJ1Y2tldDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfU1RPUkFHRV9CVUNLRVQgfHwgZmlyZWJhc2VTZXJ2aWNlQWNjb3VudC5wcm9qZWN0X2lkICsgJy5hcHBzcG90LmNvbSdcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZyhcIkZpcmViYXNlIEFkbWluIFNESyBpbml0aWFsaXplZCB3aXRoIHNlcnZpY2UgYWNjb3VudCBmcm9tIEFXUyBTZWNyZXRzIE1hbmFnZXIuXCIpO1xuICAgIH0gY2F0Y2ggKHNlY3JldHNNYW5hZ2VyRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGdldCBGaXJlYmFzZSBzZXJ2aWNlIGFjY291bnQgZnJvbSBBV1MgU2VjcmV0cyBNYW5hZ2VyOiAke3NlY3JldHNNYW5hZ2VyRXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiQXR0ZW1wdGluZyBmYWxsYmFjayB0byBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIEZpcmViYXNlIGNvbmZpZ3VyYXRpb24uLi5cIik7XG4gICAgICBcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCFwcm9jZXNzLmVudi5GSVJFQkFTRV9QUk9KRUNUX0lEKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGSVJFQkFTRV9QUk9KRUNUX0lEIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIHJlcXVpcmVkIHdoZW4gRmlyZWJhc2Ugc2VydmljZSBhY2NvdW50IGlzIG5vdCBpbiBBV1MgU2VjcmV0cyBNYW5hZ2VyJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFVzZSBBcHBsaWNhdGlvbiBEZWZhdWx0IENyZWRlbnRpYWxzIG9yIGVudmlyb25tZW50LWJhc2VkIGluaXRpYWxpemF0aW9uXG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgcHJvamVjdElkOiBwcm9jZXNzLmVudi5GSVJFQkFTRV9QUk9KRUNUX0lELFxuICAgICAgICAgIHN0b3JhZ2VCdWNrZXQ6IHByb2Nlc3MuZW52LkZJUkVCQVNFX1NUT1JBR0VfQlVDS0VUIHx8IHByb2Nlc3MuZW52LkZJUkVCQVNFX1BST0pFQ1RfSUQgKyAnLmFwcHNwb3QuY29tJ1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHNlcnZpY2UgYWNjb3VudCBmaWxlIHBhdGgsIHVzZSBpdFxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTICYmIGZzLmV4aXN0c1N5bmMocHJvY2Vzcy5lbnYuR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXNpbmcgR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTIGZpbGUgZm9yIEZpcmViYXNlIGF1dGhlbnRpY2F0aW9uLlwiKTtcbiAgICAgICAgICBjb25zdCBzZXJ2aWNlQWNjb3VudCA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHByb2Nlc3MuZW52LkdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUywgJ3V0ZjgnKSk7XG4gICAgICAgICAgb3B0aW9ucy5jcmVkZW50aWFsID0gY2VydChzZXJ2aWNlQWNjb3VudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJVc2luZyBBcHBsaWNhdGlvbiBEZWZhdWx0IENyZWRlbnRpYWxzIGZvciBGaXJlYmFzZSBhdXRoZW50aWNhdGlvbi5cIik7XG4gICAgICAgICAgLy8gRmlyZWJhc2UgQWRtaW4gU0RLIHdpbGwgYXV0b21hdGljYWxseSB1c2UgQXBwbGljYXRpb24gRGVmYXVsdCBDcmVkZW50aWFsc1xuICAgICAgICAgIC8vIFRoaXMgd29ya3MgaW4gZW52aXJvbm1lbnRzIGxpa2UgR29vZ2xlIENsb3VkIFJ1biwgQXBwIEVuZ2luZSwgZXRjLlxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhcIkZpcmViYXNlIEFkbWluIFNESyBpbml0aWFsaXplZCB3aXRoIGVudmlyb25tZW50IHZhcmlhYmxlcyBmYWxsYmFjay5cIik7XG4gICAgICB9IGNhdGNoIChmYWxsYmFja0Vycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWxsYmFjayB0byBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYWxzbyBmYWlsZWQ6XCIsIGZhbGxiYWNrRXJyb3IubWVzc2FnZSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGluaXRpYWxpemUgRmlyZWJhc2UgQWRtaW4gU0RLIHdpdGggQVdTIFNlY3JldHMgTWFuYWdlcjogJHtzZWNyZXRzTWFuYWdlckVycm9yLm1lc3NhZ2V9LiBGYWxsYmFjayB0byBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYWxzbyBmYWlsZWQ6ICR7ZmFsbGJhY2tFcnJvci5tZXNzYWdlfS4gUGxlYXNlIGVuc3VyZSBlaXRoZXIgdGhlIEZpcmViYXNlIHNlcnZpY2UgYWNjb3VudCBpcyBwcm9wZXJseSBjb25maWd1cmVkIGluIEFXUyBTZWNyZXRzIE1hbmFnZXIsIG9yIEZJUkVCQVNFX1BST0pFQ1RfSUQgYW5kIEdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUyBhcmUgc2V0LmApO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZyhcIlVzaW5nIERldmVsb3BtZW50IGNvbmZpZ3VyYXRpb24gZm9yIEFkbWluIFNESyB3aXRoIGxvY2FsIHNlcnZpY2UgYWNjb3VudCBmaWxlLlwiKTtcbiAgICBjb25zdCBzZXJ2aWNlQWNjb3VudFBhdGggPSBwcm9jZXNzLmVudi5HT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFM7XG4gICAgaWYgKCFzZXJ2aWNlQWNjb3VudFBhdGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUyBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0LlwiKTtcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VBY2NvdW50ID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoc2VydmljZUFjY291bnRQYXRoLCAndXRmOCcpKTtcbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIGNyZWRlbnRpYWw6IGNlcnQoc2VydmljZUFjY291bnQpLFxuICAgICAgICBwcm9qZWN0SWQ6IHNlcnZpY2VBY2NvdW50LnByb2plY3RfaWQsXG4gICAgICAgIHN0b3JhZ2VCdWNrZXQ6IHByb2Nlc3MuZW52LkZJUkVCQVNFX1NUT1JBR0VfQlVDS0VUXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgb3IgcGFyc2UgU2VydmljZSBBY2NvdW50IEtleTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgY29uc29sZS5sb2coYEluaXRpYWxpemluZyBhZG1pbiBhcHAgXCIke2FwcE5hbWV9XCIgd2l0aCBwcm9qZWN0IElEOmAsIG9wdGlvbnMucHJvamVjdElkKTtcbiAgY29uc3QgYXBwID0gaW5pdGlhbGl6ZUFwcChvcHRpb25zLCBhcHBOYW1lKTtcbiAgXG4gIC8vIExvZyBlbXVsYXRvciBjb25uZWN0aW9uIHN0YXR1cyBpbiB0ZXN0IG1vZGVcbiAgaWYgKGlzVGVzdCkge1xuICAgIGNvbnNvbGUubG9nKGDinIUgQWRtaW4gYXBwIFwiJHthcHBOYW1lfVwiIGluaXRpYWxpemVkIGZvciB0ZXN0aW5nIHdpdGggZW11bGF0b3JzYCk7XG4gIH1cbiAgXG4gIHJldHVybiBhcHA7XG59XG5cbi8vIExhenkgaW5pdGlhbGl6YXRpb24gY2FjaGVcbmxldCBhZG1pbkFwcFByb21pc2UgPSBudWxsO1xuXG4vLyBBc3luYyBmdW5jdGlvbiB0byBnZXQgYWRtaW4gYXBwXG5hc3luYyBmdW5jdGlvbiBnZXRBZG1pbkFwcCgpIHtcbiAgaWYgKCFhZG1pbkFwcFByb21pc2UpIHtcbiAgICBhZG1pbkFwcFByb21pc2UgPSBpbml0aWFsaXplQWRtaW4oKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgYWRtaW5BcHBQcm9taXNlO1xufVxuXG4vLyBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgZXhwb3J0IGEgc3luY2hyb25vdXMgdmVyc2lvbiBmb3Igbm9uLXByb2R1Y3Rpb24gZW52aXJvbm1lbnRzXG5sZXQgYWRtaW5BcHA7XG5pZiAoaXNUZXN0IHx8ICghaXNQcm9kdWN0aW9uIHx8IHByb2Nlc3MuZW52LlVTRV9BV1NfU0VDUkVUUyAhPT0gJ3RydWUnKSkge1xuICAvLyBGb3IgdGVzdCBvciBkZXZlbG9wbWVudCBlbnZpcm9ubWVudHMsIGluaXRpYWxpemUgc3luY2hyb25vdXNseSB1c2luZyB0aGUgb2xkIGFwcHJvYWNoXG4gIGNvbnNvbGUubG9nKFwiVXNpbmcgc3luY2hyb25vdXMgaW5pdGlhbGl6YXRpb24gZm9yIGRldmVsb3BtZW50L3Rlc3QgZW52aXJvbm1lbnQuXCIpO1xuICB0cnkge1xuICAgIC8vIFVzZSB0aGUgc3luY2hyb25vdXMgdmVyc2lvbiBmb3IgZGV2ZWxvcG1lbnRcbiAgICBpZiAoaXNUZXN0KSB7XG4gICAgICBhZG1pbkFwcCA9IGluaXRpYWxpemVBcHAoe1xuICAgICAgICBwcm9qZWN0SWQ6IFwiZGVtby10ZXN0XCIsXG4gICAgICAgIHN0b3JhZ2VCdWNrZXQ6IFwiZGVtby10ZXN0LmFwcHNwb3QuY29tXCJcbiAgICAgIH0sIGFwcE5hbWUpO1xuICAgICAgY29uc29sZS5sb2coYPCfp6ogU3luY2hyb25vdXMgYWRtaW4gYXBwIGluaXRpYWxpemVkIGZvciB0ZXN0aW5nIHdpdGggcHJvamVjdDogZGVtby10ZXN0YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNlcnZpY2VBY2NvdW50UGF0aCA9IHByb2Nlc3MuZW52LkdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUztcbiAgICAgIGlmIChzZXJ2aWNlQWNjb3VudFBhdGggJiYgZnMuZXhpc3RzU3luYyhzZXJ2aWNlQWNjb3VudFBhdGgpKSB7XG4gICAgICAgIGNvbnN0IHNlcnZpY2VBY2NvdW50ID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoc2VydmljZUFjY291bnRQYXRoLCAndXRmOCcpKTtcbiAgICAgICAgYWRtaW5BcHAgPSBpbml0aWFsaXplQXBwKHtcbiAgICAgICAgICBjcmVkZW50aWFsOiBjZXJ0KHNlcnZpY2VBY2NvdW50KSxcbiAgICAgICAgICBwcm9qZWN0SWQ6IHNlcnZpY2VBY2NvdW50LnByb2plY3RfaWQsXG4gICAgICAgICAgc3RvcmFnZUJ1Y2tldDogcHJvY2Vzcy5lbnYuRklSRUJBU0VfU1RPUkFHRV9CVUNLRVRcbiAgICAgICAgfSwgYXBwTmFtZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFMgbm90IGZvdW5kLiBXaWxsIGluaXRpYWxpemUgd2hlbiBmaXJzdCBhY2Nlc3NlZC5cIik7XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignV2FybmluZzogU3luY2hyb25vdXMgYWRtaW4gYXBwIGluaXRpYWxpemF0aW9uIGZhaWxlZDonLCBlcnJvci5tZXNzYWdlKTtcbiAgICBjb25zb2xlLmxvZygnQWRtaW4gYXBwIHdpbGwgYmUgaW5pdGlhbGl6ZWQgYXN5bmNocm9ub3VzbHkgd2hlbiBmaXJzdCBhY2Nlc3NlZC4nKTtcbiAgfVxufSBlbHNlIHtcbiAgY29uc29sZS5sb2coXCJQcm9kdWN0aW9uIG1vZGUgZGV0ZWN0ZWQuIEFkbWluIGFwcCB3aWxsIGJlIGluaXRpYWxpemVkIGFzeW5jaHJvbm91c2x5IHdoZW4gZmlyc3QgYWNjZXNzZWQuXCIpO1xufVxuXG5leHBvcnQgeyBhZG1pbkFwcCwgZ2V0QWRtaW5BcHAgfTtcblxuLy8gT3B0aW9uYWw6IEZ1bmN0aW9uIHRvIGNsZWFuIHVwIHRoZSBhZG1pbiBhcHBcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVBZG1pbkFwcCgpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhcHBUb0RlbGV0ZSA9IGdldEFwcChhcHBOYW1lKTtcbiAgICAgICAgYXdhaXQgZGVsZXRlQXBwKGFwcFRvRGVsZXRlKTtcbiAgICAgICAgY29uc29sZS5sb2coYEFkbWluIGFwcCBcIiR7YXBwTmFtZX1cIiBkZWxldGVkLmApO1xuICAgICAgICAvLyBSZXNldCB0aGUgcHJvbWlzZSBjYWNoZVxuICAgICAgICBhZG1pbkFwcFByb21pc2UgPSBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmICghZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcIk5vIEZpcmViYXNlIEFwcFwiKSAmJiAhZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcImFscmVhZHkgZGVsZXRlZFwiKSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBDb3VsZCBub3QgZGVsZXRlIGFkbWluIGFwcCBcIiR7YXBwTmFtZX1cIjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyx3QkFBd0I7O0FBRS9CO0FBQ0EsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLLE1BQU0sSUFBSUYsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxVQUFVO0FBQ3JGLE1BQU1DLFlBQVksR0FBR0gsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxZQUFZO0FBRTFELElBQUlILE1BQU0sRUFB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